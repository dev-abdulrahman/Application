@model IEnumerable<Application.Entities.Models.Book>

<table class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>ISBN</th>
            <th>Published Date</th>
            <th>Availability</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var book in Model)
        {
            <tr id="bookRow-@book.BookId">
                <td>@book.Title</td>
                <td>@book.Author</td>
                <td>@book.ISBN</td>
                <td>@book.PublishedDate.ToString("yyyy-MM-dd")</td>
                <td>
                    @if (book.IsAvailable)
                    {
                        <span class="badge bg-success">Available</span>
                    }
                    else
                    {
                        <span class="badge bg-danger">Borrowed</span>
                    }
                </td>
                <td>
                    <a class="btn btn-info btn-sm open-modal"
                       data-url="@Url.Action(nameof(BooksController.Details), new { id = book.BookId })"
                       data-title="Details"
                       data-icon="bi bi-pencil-square"
                       data-action-text="Edit">
                        Details
                    </a>
                    <a class="btn btn-warning btn-sm open-modal"
                       data-url="@Url.Action(nameof(BooksController.Edit), new { id = book.BookId })"
                       data-title="Edit"
                       data-icon="bi bi-save"
                       data-action-text="Save Changes">
                        Edit
                    </a>
                    <a class="btn btn-danger btn-sm open-modal"
                       data-url="@Url.Action(nameof(BooksController.Delete), new { id = book.BookId })"
                       data-title="Delete"
                       data-icon="bi bi-trash-fill"
                       data-action-text="Delete">
                        Delete
                    </a>

                    @if (book.IsAvailable)
                    {
                        <a class="btn btn-primary btn-sm open-modal"
                           data-url="@Url.Action(nameof(BorrowController.Create), nameof(BorrowController).Replace("Controller", ""), new { bookId = book.BookId })"
                           data-title="Borrow Book"
                           data-icon="bi bi-check-circle"
                           data-action-text="Confirm Borrow">
                            Borrow
                        </a>
                    }
                    else
                    {
                        var activeBorrowRecord = book.BorrowRecords?.FirstOrDefault(br => br.ReturnDate == null);
                        if (activeBorrowRecord != null)
                        {
                            <a class="btn btn-success btn-sm open-modal"
                               data-url="@Url.Action(nameof(BorrowController.Return), nameof(BorrowController).Replace("Controller", ""), new { borrowRecordId = activeBorrowRecord.BorrowRecordId })"
                               data-title="Return Book"
                               data-icon="bi bi-check-circle"
                               data-action-text="Confirm Return">
                                Return
                            </a>
                        }
                        else
                        {
                            <span class="text-muted">No active borrow record</span>
                        }
                    }
                </td>
            </tr>
        }
    </tbody>
</table>